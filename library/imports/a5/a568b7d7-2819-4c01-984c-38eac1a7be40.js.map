{"version":3,"sources":["assets/script/common/effect/SpriteToHome.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameUtils } from \"../../game/GameUtils\";\nimport { Utils } from \"../../utils/Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class SpriteToHome extends cc.Component {\n\n    //全局计数\n    // private static NumAll = 0;\n    /**\n     * 创建一个载体，并挂载一个乘客\n     * @param passenger \n     * @param startWorldPos \n     * @param endWorldPos \n     */\n    public static async createVehicle(passer: cc.Node, startWorldPos: cc.Vec2, endWorldPos: cc.Vec2, withRotation: boolean, next: Function) {\n        let vehicle = new cc.Node();\n        vehicle.width = passer.width;\n        vehicle.height = passer.height;\n        vehicle.position = startWorldPos;\n\n        let passenger = cc.instantiate(passer);\n        passenger.removeComponent(cc.Widget);\n        passenger.x = 0;\n        passenger.y = 0;\n        passenger.parent = vehicle;\n\n        let script: SpriteToHome = vehicle.addComponent(SpriteToHome);\n        script.next = next;\n        script.withRotation = withRotation;\n        script.endEffectPos = GameUtils.effectLayer.convertToNodeSpaceAR(endWorldPos);\n        script.icon = passenger;\n        GameUtils.addEffectAR(vehicle);\n    }\n\n    public static async create(spriteFrame: cc.SpriteFrame, startWorldPos: cc.Vec2, endWorldPos: cc.Vec2, withRotation: boolean, next?: Function, scale: number = 1) {\n        let node = new cc.Node();\n        let icon = new cc.Node();\n        node.addChild(icon);\n        let sprite = icon.addComponent(cc.Sprite);\n        icon.scale = scale;\n        sprite.sizeMode = cc.Sprite.SizeMode.RAW;\n        sprite.spriteFrame = spriteFrame;\n        let script: SpriteToHome = node.addComponent(SpriteToHome);\n        script.withRotation = withRotation;\n        script.next = next;\n        node.position = startWorldPos;\n        script.endEffectPos = GameUtils.effectLayer.convertToNodeSpaceAR(endWorldPos);\n        GameUtils.addEffectAR(node);\n    }\n\n    public static async createNode(effNode: cc.Node, startWorldPos: cc.Vec2, endWorldPos: cc.Vec2, withRotation: boolean, next?: Function, toScale: number = 1, aniBackOut: boolean = true) {\n        let node = new cc.Node(\"effectNode\");\n\n        effNode.parent = node;\n        effNode.position = cc.v2(0, 0);\n        node.position = startWorldPos;\n        let script: SpriteToHome = node.addComponent(SpriteToHome);\n        script.withRotation = withRotation;\n        script.endEffectPos = GameUtils.effectLayer.convertToNodeSpaceAR(endWorldPos);\n        script.next = next;\n        script.toScale = toScale;\n        script.aniBackOut = aniBackOut;\n        GameUtils.addEffectAR(node);\n    }\n\n    icon: cc.Node = null;\n    withRotation: boolean = false;\n    endEffectPos: cc.Vec2 = undefined;\n    spdx: number = 30;\n    spdy: number = 10;\n    groundNum: number = 0;\n    center: cc.Vec2 = undefined;\n    status: boolean = true;\n    next: Function = undefined;\n    toScale: number = 1;\n    aniBackOut: boolean = true;\n\n    onLoad() {\n        // SpriteToHome.NumAll++;\n        this.icon = this.node.children[0];\n        let homeDuration = 0.8;// Utils.randomFloat(0.5, 1.5);\n        this.node.scale = Utils.randomFloat(0.9, 1.1);\n        cc.tween(this.node).to(homeDuration, { position: this.endEffectPos, scale: this.toScale }, { easing: cc.easing.sineIn }).call(() => {\n            cc.tween(this.node).to(0.2, { opacity: 0, scale: 1.4 }, { easing: cc.easing.sineOut }).call(() => {\n                this.icon.stopAllActions();\n                this.node.stopAllActions();\n                Utils.removeNode(this.node);\n            }).start();\n            this.next && this.next();\n        }).start();\n\n        if (this.withRotation) {\n            this.icon.angle = 180;\n        }\n\n        // let p = { x: Utils.randomIntInclusive(-150, 150) };\n        // if (this.withRotation) {\n        //     p[\"angle\"] = 90;\n        // }\n        // cc.tween(this.icon).to(homeDuration * 0.3, p, { easing: \"sineOut\" }).call(() => {\n        //     p = { x: 0 };\n        //     if (this.withRotation) {\n        //         p[\"angle\"] = 0;\n        //     }\n        //     cc.tween(this.icon).to(homeDuration * 0.7, p, { easing: \"sineIn\" }).start();\n        // }).start();\n        // let deltaV = this.endEffectPos.y - this.node.y;\n        if (this.aniBackOut) {\n            cc.tween(this.icon)\n                .to(homeDuration * 0.3, { y: -200 }, { easing: cc.easing.sineInOut })\n                .to(homeDuration * 0.7, { y: 0 }, { easing: cc.easing.sineIn })\n                .start();\n        }\n    }\n}\n"]}
{"version":3,"sources":["assets/script/common/Ball_Main.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { bc } from \"../game/ui/bl_Config\";\nimport BundleResourceList from \"../game/common/BundleResourceList\";\nimport { ui } from \"../game/common/UIManager\";\nimport LoadingScene from \"../game/loading/LoadingScene\";\nimport { initSource } from \"../lang/LanguageData\";\nimport { sdk } from \"../utils/SDKManager\";\nimport { Utils } from \"../utils/Utils\";\nimport { sd } from \"./AudioManager\";\nimport HurryLoading from \"./comp/HurryLoading\";\nimport SceneLoadingUI from \"./comp/SceneLoadingUI\";\nimport { GlobalDefines } from \"./consts/GlobalDefines\";\nimport { dm } from \"./DataManager\";\nimport { sm } from \"./SceneManager\";\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\n\nexport default class Ball_Main extends cc.Component {\n    public static _instance: Ball_Main;\n    public static get instance(): Ball_Main {\n        return this._instance;\n    }\n\n    @property(cc.Node)\n    uiNode: cc.Node = null;\n\n    // 加载等待图标\n    @property(HurryLoading)\n    hurryLoading: HurryLoading = null;\n\n    @property(cc.Camera)\n    uiCamera: cc.Camera = null;\n\n    @property(cc.Node)\n    smNode: cc.Node = null;\n\n    @property(BundleResourceList)\n    resList: BundleResourceList = null;\n\n    @property(cc.JsonAsset)\n    config: cc.JsonAsset = null;\n\n    //本地与服务器的时间差 秒\n    public timeOffset_sec: number = 0;\n    //本地与服务器的时间差 毫秒\n    private timeOffset_msec: number = 0;\n\n    private timeout_crossday: any = undefined;\n\n    public isInited: boolean = false;\n\n    public entryData: any = undefined;\n\n    public toBackgroundOSTime: number;\n\n    public playtime: number;\n\n    async onShow(res: any) {\n        this.entryData = res;\n\n        sd.resumeAll();\n\n        if (!this.isInited) {\n            return;\n        }\n        // wall.loadTask();\n    }\n\n    async onHide() {\n        sd.pauseAll();\n    }\n\n    pase(country) {\n        const jsonContent = this.config.json.language;\n        //开始加密文本\n        // for (let country in jsonContent) {\n        let countryConfig = jsonContent[country]\n        for (let key in countryConfig) {\n            let text = countryConfig[key]\n            console.log(\"开始解密文件==>\", text)\n            countryConfig[key] = decodeURIComponent(atob(text));\n            console.log(\"解密后==>\", countryConfig[key])\n        }\n        // }\n\n        // 将修改后的对象转换回JSON字符串\n        // const modifiedJson = JSON.stringify(jsonContent, null, 2);\n        return jsonContent[country];\n    }\n\n    // 游戏启动\n    onLoad() {\n\n        window.addEventListener(\"unhandledrejection\", function (e) {\n            e.preventDefault();\n            return true;\n        });\n\n        ui.onLoad(this.uiNode, this.hurryLoading);\n\n        // 挂载sceneManager操作的根节点\n        sm.onLoad(this.smNode);\n\n        // 获取国家\n        bc.country = sdk.ball_getCountry();\n\n        // 标记语言\n        let langue;\n        switch (bc.country) {\n            case '2':\n                langue = this.pase(\"pt\");\n                initSource(\"pt\", langue);\n                // initSource(\"pt\", this.config.json.language['pt']);\n                bc.moneyAbbr = \"R$\";\n                break;\n            case \"10\":\n                langue = this.pase(\"en\");\n                initSource(\"en\", langue);\n                bc.moneyAbbr = \"£\";\n                break;\n            case \"11\":\n                langue = this.pase(\"en\");\n                initSource(\"en\", langue);\n                bc.moneyAbbr = \"R\";\n                break;\n            case \"12\":\n                langue = this.pase(\"en\");\n                initSource(\"en\", langue);\n                bc.moneyAbbr = \"₦\";\n                break;\n            case \"13\":\n                // initSource(\"in\", this.config.json.language['in']);\n                langue = this.pase(\"in\");\n                initSource(\"in\", langue);\n                bc.moneyAbbr = \"₹\";\n                break;\n            default:\n                langue = this.pase(\"en\");\n                initSource(\"en\", langue);\n                bc.moneyAbbr = \"$\";\n                break;\n        }\n    }\n\n    start() {\n        this.gameStart();\n        // setTimeout(() => {\n        //     sd.playBGM(`sounds/bg`,true);\n        // }, 200);\n    }\n\n    /**\n    * 微信监听好友定向分享回调\n    * 返回分享成功与否\n    * @param res \n    */\n    onShareMessageToFriend(res: { success: boolean, errMsg: string }) {\n        // let event = new EventShareMessageToFriend();\n        // event.res = res;\n        // GlobalEvent.dispatchEvent(event);\n        // Logger.debug(\"[Ball_Main onShareMessageToFriend] res:\", res);\n    }\n\n    async gameStart() {\n        // 获取时间（好像现在没法先有什么引用的地方）\n        this.playtime = Utils.getCurTime();\n\n        // 场景根节点的引用\n        Ball_Main._instance = this;\n\n        // 延迟调用\n        setTimeout(() => {\n\n            // 添加游戏的各个层级节点，作为游戏场景根节点的子节点存在\n            ui.checkNode();\n\n            // 加载场景初始化\n            let loadingScene: LoadingScene = sm.node.getComponentInChildren(LoadingScene);\n            loadingScene.startLoading();\n        }, 0);\n    }\n\n    async initGame() {\n        SceneLoadingUI.setProgress(0);\n\n        // dataManager 开始准备 - 登录接口调用\n        await dm.onInit();\n        SceneLoadingUI.setProgress(0.6);\n\n        Utils.waiting(0);\n        SceneLoadingUI.setProgress(0.7);\n\n        Utils.waiting(0);\n        SceneLoadingUI.setProgress(0.75);\n\n        Utils.waiting(0);\n        SceneLoadingUI.setProgress(0.8);\n\n        ui.onInit();\n\n        Utils.waiting(0);\n        SceneLoadingUI.setProgress(0.85);\n\n        sd.init();\n\n        // await topres.onLoad(ui.getLayer(UILayer.Topres))\n\n        Utils.waiting(0);\n        SceneLoadingUI.setProgress(0.9);\n        Utils.waiting(0);\n        //进度条延时\n        // for (let i = 1; i <= 10; i++) {\n        //     SceneLoadingUI.setProgress(i / 10);\n        //     await Utils.waiting(20);\n        // }\n        this.registerCrossEvent();\n    }\n\n    public GetScreenWHRate() {\n        var screenSize = cc.view.getFrameSize();\n        var currentScreenRate = screenSize.width / screenSize.height;\n        return currentScreenRate;\n    }\n\n    //获取服务器时间戳 秒\n    getServerTime() {\n        return Math.floor((new Date()).getTime() / 1000) + this.timeOffset_sec;\n    }\n\n    //获取服务器时间戳 毫秒\n    getServerTimeMsec() {\n        return (new Date()).getTime() + this.timeOffset_msec;\n    }\n\n    /**\n     * 时间同步检测\n     * @param serverTime \n     */\n    timeCheck(serverTime: number) {\n        let curLocationTime = (new Date()).getTime();\n        this.timeOffset_sec = serverTime - Math.floor(curLocationTime / 1000);\n        this.timeOffset_msec = serverTime * 1000 - curLocationTime;\n\n        return Math.abs(this.timeOffset_sec) < GlobalDefines.Second_Day;\n    }\n\n    /**\n     * 注册跨天回调\n     */\n    registerCrossEvent() {\n        //同步时间后 注册跨天回调\n        let curTime = this.getServerTimeMsec();\n        let todyStartTime = Utils.getDayBeginTime(curTime);\n        let tomorryStartTime = todyStartTime / 1000 + GlobalDefines.Second_Day;\n        let offset = Utils.randomInt(0, 60 * 1);//1分钟错峰时间\n        let deta = tomorryStartTime - curTime / 1000 + offset;\n        clearTimeout(this.timeout_crossday);\n        this.timeout_crossday = setTimeout(() => {\n            this.onCrossDay();\n        }, deta * 1000);\n    }\n\n    /**\n     * 跨天处理\n     */\n    onCrossDay() {\n        //跨天重登录\n        sm.switchScene(LoadingScene);\n    }\n\n\n}\n\n"]}
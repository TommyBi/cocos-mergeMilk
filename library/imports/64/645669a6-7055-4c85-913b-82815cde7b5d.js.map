{"version":3,"sources":["assets/script/merge/dataModule/GameModule.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { EventType } from '../manager/Define';\nimport { eventManager, GameEvent } from '../util/EventManager';\nimport Utils from '../util/Utils';\nimport DataModule from './DataModule';\n\nexport default class GameModule extends DataModule {\n    // 用户的筹码槽位数据 1~10\n    public slotData = [\n        [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n        [1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n        [1, 1, 2, 2, 3, 3, 4, 4, 5, 5],\n        [2, 2, 3, 1, 1, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    ]\n\n    // 当前正在选中的筹码槽位\n    curSelectSlotIdx: number = -1;\n    // 当前选中的筹码信息\n    curSelectCoinIdxs: number[] = [];\n\n    // 移动锁\n    moveLock: boolean = false;\n    mergeLock: number = 0;\n\n    constructor() {\n        super();\n    }\n\n    parseData(data: any): void {\n        super.parseData(data);\n    }\n\n    /**\n     * @description 通过槽id 获取第一个有效的筹码信息\n     * @param slotIdx: 需要获取第一个有效的筹码信息的槽id\n     * @return vaildNum: 该槽位的有效数字、vaildIdx: 有效数字的索引、vaildSPace: 剩余可容纳的筹码空间\n     */\n    getFirstVaildNumBySlotIdx(slotIdx: number): { vaildNum: number, vaildIdx: number, vaildSpace: number } {\n        const slotData = this.slotData[slotIdx];\n\n        let vaildNum: number = -1;\n        let vaildIdx: number = -1;\n        let vaildSpace: number = 10;\n\n        for (let i = 9; i >= 0; i--) {\n            if (slotData[i] === 0) continue;\n\n            vaildNum = slotData[i];\n            vaildIdx = i;\n            vaildSpace = 9 - i;\n            break;\n        }\n\n        return { vaildNum, vaildIdx, vaildSpace };\n    }\n\n    /**\n     * @description 获取当前选中的待移动的槽位筹码信息\n     * @returns slotIdx: 当前选中的槽位索引、  cnt: 待移动的筹码数量、  num: 待移动的数字类型\n     */\n    getCurSelectSlotInfo(): { slotIdx: number, cnt: number, num: number } {\n        if (this.curSelectSlotIdx === -1) return null;\n        const cnt = this.curSelectCoinIdxs.length;\n        const num = this.slotData[this.curSelectSlotIdx][this.curSelectCoinIdxs[0]];\n        return { slotIdx: this.curSelectSlotIdx, cnt, num };\n    }\n\n    // 重置当前筹码选择状态\n    resetSelectStatus(): void {\n        gameModule.curSelectSlotIdx = -1;\n        gameModule.curSelectCoinIdxs = [];\n    }\n\n    // 筹码移动完成，整理移动后的数据\n    tidySlotData(ed: { tarSlotIdx: number, numType: number, srcIdxArr: number[], tarIdxArr: number[] }) {\n        for (let i = 0; i < ed.srcIdxArr.length; i++) {\n            this.slotData[this.curSelectSlotIdx][ed.srcIdxArr[i]] = 0;\n            this.slotData[ed.tarSlotIdx][ed.tarIdxArr[i]] = ed.numType;\n        }\n\n        // 刷新筹码显示情况\n        eventManager.dispatchEvent(new GameEvent(EventType.MOVE_END, ed));\n\n        // 重置当前选中状态\n        this.resetSelectStatus();\n\n        // 检测是否可以合成\n        eventManager.dispatch(EventType.CHECK_MERGE);\n    }\n\n    // 检测是否有可以合成的槽位\n    checkCanMerge(): number[] {\n        const result = [];\n        for (let i = 0; i < 8; i++) {\n            const can = this.checkCanMergeBySlot(i);\n            if (can) result.push(i);\n        }\n\n        return result;\n    }\n\n    // 通过槽位来检测是否可以进行合成\n    checkCanMergeBySlot(slotId: number): boolean {\n        const slotData = this.slotData[slotId];\n        for (let i = 0; i < 10; i++) {\n            if (slotData[i] === 0) return false;\n            if (i === 0) continue;\n            if (slotData[i] !== slotData[i - 1]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    // 生成新的筹码数据\n    produceNewCoinData(): number[][] {\n        const newData = [\n            [],\n            [],\n            [],\n            [],\n            [],\n            [1, 1, 2, 2],\n            [1, 1, 1, 1],\n            [3, 3, 4, 4],\n        ];\n        return newData;\n    }\n\n    // TODO: 新生成的数据和原有数据进行合成\n    mergeProduceData(newData: number[][]): void {\n        for (let slotIdx = 0; slotIdx < 8; slotIdx++) {\n            const newSlotData = Utils.deepClone(newData[slotIdx]);\n            for (let j = 0; j < 10; j++) {\n                if (this.slotData[slotIdx][j] === 0 && newSlotData.length > 0) {\n                    const newCoinData = newSlotData.shift();\n                    this.slotData[slotIdx][j] = newCoinData;\n                }\n            }\n        }\n    }\n}\nexport const gameModule = new GameModule();\n"]}
{"version":3,"sources":["assets/script/common/comp/NumberAction.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Utils } from \"../../utils/Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class NumberAction extends cc.Component {\n    public label: cc.Label = null;\n    public targetNumber: number = 0;\n    public startNum: number = 0;\n    public startTime: number = 0;\n    public duration: number = 0;\n    public playing: boolean = false;\n    public colorBackup: cc.Color = null;\n    public scaleBackup: cc.Vec2 = null;\n    public targetColor: cc.Color = null;\n    /**\n     * \n     * @param labelNode label所在的node\n     * @param targetNumber 目标数字\n     * @param duration 毫秒\n     */\n    onLoad() {\n        // this.label = this.node.getComponent(cc.Label);\n        // this.colorBackup = this.label.node.color;\n        // this.scaleBackup = cc.v2(this.label.node.scaleX, this.label.node.scaleY);\n    }\n    public static numberTo(labelNode: cc.Node, targetNumber: number, duration: number = 300, color?: cc.Color) {\n        let label = labelNode.getComponent(cc.Label);\n        if (!label) {\n            return;\n        }\n        let numberAction = labelNode.getComponent(NumberAction);\n        if (!numberAction) {\n            numberAction = labelNode.addComponent(NumberAction);\n        }\n        numberAction.numberTo(targetNumber, duration, color);\n    }\n\n    public numberTo(targetNumber: number, duration: number = 300, color?: cc.Color) {\n        if (!this.label) {\n            this.label = this.node.getComponent(cc.Label);\n            this.colorBackup = this.label.node.color;\n            this.scaleBackup = cc.v2(this.label.node.scaleX, this.label.node.scaleY);\n        }\n        if (targetNumber == ~~this.label.string) {\n            return;\n        }\n        this.targetNumber = targetNumber;\n        this.duration = duration;\n\n        this.startNum = Utils.isNum(this.label.string) ? Number(this.label.string) : 0;\n        this.startTime = (new Date()).getTime();\n        this.playing = true;\n        if (!!color) {\n            this.targetColor = color;\n            this.label.node.color = color;\n\n            this.label.node.scaleX = this.scaleBackup.x * 1.2;\n            this.label.node.scaleY = this.scaleBackup.y * 1.2;\n        }\n    }\n\n    checkColor(c1: cc.Color, c2: cc.Color) {\n        if (c1.getA() != c2.getA()) {\n            return false;\n        }\n        if (c1.getB() != c2.getB()) {\n            return false;\n        }\n        if (c1.getG() != c2.getG()) {\n            return false;\n        }\n        if (c1.getR() != c2.getR()) {\n            return false;\n        }\n    }\n    update(dt: Number) {\n        if (!this.label) {\n            return;\n        }\n        if (!this.playing) {\n            return;\n        }\n        let curTime = (new Date()).getTime();\n        if (curTime >= this.startTime + this.duration) {\n            this.label.node.color = this.colorBackup;\n            this.label.string = \"\" + this.targetNumber;\n            this.label.node.scaleX = this.scaleBackup.x;\n            this.label.node.scaleY = this.scaleBackup.y;\n            this.playing = false;\n            return;\n        }\n        //todo::为什么要每桢都设置目标色才能实现变化是变色，是谁在捣乱\n        if (!!this.targetColor) {\n            this.label.node.color = this.targetColor;\n        }\n        let ratio = (curTime - this.startTime) / this.duration;\n        let curNum = this.startNum + (this.targetNumber - this.startNum) * ratio;\n        this.label.string = \"\" + Math.floor(curNum);\n    }\n\n}\n"]}